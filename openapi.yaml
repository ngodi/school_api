openapi: 3.0.0
info:
  title: School Management API
  version: 1.0.0
  description: API documentation for School Management
servers:
  - url: http://localhost:5000
paths:
  /api/v1/users/create:
    post:
      tags: [Users]
      security:
        - BearerAuth: []
      summary: Create a user (schooladmin) by superadmin or schooladmin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  example: johndoe@gmail.com
                firstName:
                  type: string
                  example: John
                lastName:
                  type: string
                  example: Doe
                phone:
                  type: string
                  example: 123-456-7890
                password:
                  type: string
                  example: 123456789
                role:
                  type: string
                  example: schooladmin
                schoolId:
                  type: string
      responses:
        200:
          description: User created
        400:
          description: Validation error
        403:
          description: Forbidden
  /api/v1/users/list:
    get:
      tags: [Users]
      security:
        - BearerAuth: []
      summary: Get all users
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
          description: Page number (default 1)
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
          description: Number of items per page (default 10)
      responses:
        200:
          description: List of users
        403:
          description: Forbidden

  /api/v1/users/get:
    get:
      tags: [Users]
      security:
        - BearerAuth: []
      summary: Get user by ID
      parameters:
        - in: query
          name: userId
          required: true
          schema:
            type: string
      responses:
        200:
          description: User details
        404:
          description: Not found
        403:
          description: Forbidden
  /api/v1/users/update:
    put:
      tags: [Users]
      security:
        - BearerAuth: []
      summary: Update user by ID
      parameters:
        - in: query
          name: userId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                  example: John
                lastName:
                  type: string
                  example: Doe
                phone:
                  type: string
                  example: 123-456-7890
      responses:
        200:
          description: User updated
        400:
          description: Validation error
        404:
          description: Not found
        403:
          description: Forbidden

  /api/v1/users/remove:
    delete:
      tags: [Users]
      security:
        - BearerAuth: []
      summary: Delete user by ID
      parameters:
        - in: query
          name: userId
          required: true
          schema:
            type: string
      responses:
        200:
          description: User deleted
        404:
          description: Not found
        403:
          description: Forbidden
  /api/v1/users/login:
    post:
      tags: [Users]
      summary: User login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  example: superadmin@example.com
                password:
                  type: string
                  example: adminpassword
      responses:
        200:
          description: Login successful
        400:
          description: Invalid credentials
  /api/v1/users/logout:
    post:
      tags: [Users]
      security:
        - BearerAuth: []
      summary: User logout
      responses:
        204:
          description: Logout successful

  /api/v1/students/create:
    post:
      tags: [Students]
      security:
        - BearerAuth: []
      summary: Create a student (schooladmin or superadmin)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                email:
                  type: string
                classroomId:
                  type: string
                schoolId:
                  type: string
                enrollmentDate:
                  type: string
                  format: date
                status:
                  type: string
                  enum: [active, transferred]
                token:
                  type: string
      responses:
        200:
          description: Student created
        400:
          description: Validation error
        403:
          description: Forbidden

  /api/v1/students/list:
    get:
      tags: [Students]
      security:
        - BearerAuth: []
      summary: List students (optionally by classroom or school)
      parameters:
        - in: query
          name: classroomId
          schema:
            type: string
        - in: query
          name: schoolId
          schema:
            type: string
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
          description: Page number (default 1)
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
          description: Number of items per page (default 10)
      responses:
        200:
          description: List of students

  /api/v1/students/get:
    get:
      tags: [Students]
      security:
        - BearerAuth: []
      summary: Get student by ID
      parameters:
        - in: query
          name: studentId
          required: true
          schema:
            type: string
      responses:
        200:
          description: Student details
        404:
          description: Not found

  /api/v1/students/update:
    put:
      tags: [Students]
      security:
        - BearerAuth: []
      summary: Update student by ID
      parameters:
        - in: query
          name: studentId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                email:
                  type: string
                classroomId:
                  type: string
                schoolId:
                  type: string
                enrollmentDate:
                  type: string
                  format: date
                status:
                  type: string
                  enum: [active, transferred]
                token:
                  type: string
      responses:
        200:
          description: Student updated
        400:
          description: Validation error
        404:
          description: Not found

  /api/v1/students/remove:
    delete:
      tags: [Students]
      security:
        - BearerAuth: []
      summary: Delete student by ID
      parameters:
        - in: query
          name: studentId
          required: true
          schema:
            type: string
      responses:
        200:
          description: Student deleted
        404:
          description: Not found

  /api/v1/students/transfer:
    post:
      tags: [Students]
      security:
        - BearerAuth: []
      summary: Transfer a student to a different school or classroom
      description: |
        Transfers a student to a new school and/or classroom. 
        The requesting user must be a schooladmin of either the student's 
        current school (source) or the destination school. Superadmins can 
        transfer any student. A transfer history record is created on every 
        successful transfer.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - studentId
                - toSchoolId
                - toClassroomId
              properties:
                studentId:
                  type: string
                  description: ID of the student to transfer
                  example: "64b1f2c3e4b0a1d2e3f40001"
                toSchoolId:
                  type: string
                  description: ID of the destination school
                  example: "64b1f2c3e4b0a1d2e3f40002"
                toClassroomId:
                  type: string
                  description: ID of the destination classroom (must belong to toSchoolId)
                  example: "64b1f2c3e4b0a1d2e3f40003"
                reason:
                  type: string
                  description: Optional reason for the transfer
                  example: "Family relocation"
      responses:
        200:
          description: Student transferred successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Student transferred successfully
                  data:
                    type: object
                    properties:
                      student:
                        type: object
                        properties:
                          _id:
                            type: string
                            example: "64b1f2c3e4b0a1d2e3f40001"
                          firstName:
                            type: string
                            example: "Jane"
                          lastName:
                            type: string
                            example: "Doe"
                          email:
                            type: string
                            example: "jane.doe@example.com"
                          schoolId:
                            type: string
                            description: Now reflects the destination school
                            example: "64b1f2c3e4b0a1d2e3f40002"
                          classroomId:
                            type: string
                            description: Now reflects the destination classroom
                            example: "64b1f2c3e4b0a1d2e3f40003"
                          status:
                            type: string
                            enum: [active, transferred]
                            example: transferred
                          admissionNumber:
                            type: string
                            example: "ADM17123456789123"
                      transfer:
                        type: object
                        description: Transfer history record created for this transfer
                        properties:
                          _id:
                            type: string
                            example: "64b1f2c3e4b0a1d2e3f40010"
                          studentId:
                            type: string
                            example: "64b1f2c3e4b0a1d2e3f40001"
                          fromSchoolId:
                            type: string
                            example: "64b1f2c3e4b0a1d2e3f40004"
                          fromClassroomId:
                            type: string
                            example: "64b1f2c3e4b0a1d2e3f40005"
                          toSchoolId:
                            type: string
                            example: "64b1f2c3e4b0a1d2e3f40002"
                          toClassroomId:
                            type: string
                            example: "64b1f2c3e4b0a1d2e3f40003"
                          transferredBy:
                            type: string
                            description: ID of the user who initiated the transfer
                            example: "64b1f2c3e4b0a1d2e3f40006"
                          reason:
                            type: string
                            nullable: true
                            example: "Family relocation"
                          status:
                            type: string
                            enum: [pending, completed, cancelled]
                            example: completed
                          transferredAt:
                            type: string
                            format: date-time
                            example: "2026-02-16T10:00:00.000Z"
        401:
          description: No token provided or token is invalid
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: No token provided
        403:
          description: Schooladmin is not associated with the source or destination school
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: You can only transfer students from or to your own school
        404:
          description: Student, destination school, or destination classroom not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Destination classroom not found
        422:
          description: Validation error or classroom does not belong to destination school
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Destination classroom does not belong to the destination school
        500:
          description: Transfer failed â€” student update or history record write error
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Transfer failed while recording history: ..."
  /api/v1/classrooms/create:
    post:
      tags: [Classrooms]
      security:
        - BearerAuth: []
      summary: Create a classroom (schooladmin or superadmin)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                code:
                  type: string
                schoolId:
                  type: string
                capacity:
                  type: integer
                courses:
                  type: array
                  items:
                    type: string
      responses:
        200:
          description: Classroom created
        400:
        description: Bad request
        403:
          description: Forbidden

  /api/v1/classrooms/list:
    get:
      tags: [Classrooms]
      security:
        - BearerAuth: []
      summary: List classrooms (optionally by school)
      parameters:
        - in: query
          name: schoolId
          schema:
            type: string
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
          description: Page number (default 1)
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
          description: Number of items per page (default 10)
      responses:
        200:
          description: List of classrooms

  /api/v1/classrooms/get:
    get:
      tags: [Classrooms]
      security:
        - BearerAuth: []
      summary: Get classroom by ID
      parameters:
        - in: query
          name: classroomId
          required: true
          schema:
            type: string
      responses:
        200:
          description: Classroom details
        404:
          description: Not found

  /api/v1/classrooms/update:
    put:
      tags: [Classrooms]
      security:
        - BearerAuth: []
      summary: Update classroom by ID
      parameters:
        - in: query
          name: classroomId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                code:
                  type: string
                capacity:
                  type: integer
                courses:
                  type: array
                  items:
                    type: string
                token:
                  type: string
      responses:
        200:
          description: Classroom updated
        400:
          description: Validation error
        404:
          description: Not found

  /api/v1/classrooms/remove:
    delete:
      tags: [Classrooms]
      security:
        - BearerAuth: []
      summary: Delete classroom by ID
      parameters:
        - in: query
          name: classroomId
          required: true
          schema:
            type: string
      responses:
        200:
          description: Classroom deleted
        404:
          description: Not found

  /api/v1/schools/create:
    post:
      tags: [Schools]
      security:
        - BearerAuth: []
      summary: Create a school (superadmin only)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "Greenwood High School"
                address:
                  type: string
                  example: "123 Main St, Springfield"
                contactEmail:
                  type: string
                  example: "johndoe@gmail.com"
                phone:
                  type: string
                  example: "+1-555-123-4567"
      responses:
        200:
          description: School created
        400:
          description: Validation error
        403:
          description: Forbidden

  /api/v1/schools/list:
    get:
      tags: [Schools]
      security:
        - BearerAuth: []
      summary: List schools
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
          description: Page number (default 1)
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
          description: Number of items per page (default 10)
      responses:
        200:
          description: List of schools

  /api/v1/schools/get:
    get:
      tags: [Schools]
      security:
        - BearerAuth: []
      summary: Get school by ID
      parameters:
        - in: query
          name: schoolId
          required: true
          schema:
            type: string
      responses:
        200:
          description: School details
        404:
          description: Not found

  /api/v1/schools/update:
    put:
      tags: [Schools]
      security:
        - BearerAuth: []
      summary: Update school by ID
      parameters:
        - in: query
          name: schoolId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                address:
                  type: string
                contactEmail:
                  type: string
                phone:
                  type: string
      responses:
        200:
          description: School updated
        400:
          description: Validation error
        404:
          description: Not found

  /api/v1/schools/remove:
    delete:
      tags: [Schools]
      security:
        - BearerAuth: []
      summary: Delete school by ID
      parameters:
        - in: query
          name: schoolId
          required: true
          schema:
            type: string
      responses:
        200:
          description: School deleted
        404:
          description: Not found

  /health:
    get:
      tags: [Health]
      summary: Health check
      responses:
        200:
          description: API is healthy

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
